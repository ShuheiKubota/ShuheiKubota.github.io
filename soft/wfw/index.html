<!doctype html><html lang>
<head>
<meta charset=utf-8>
<title>
wfw - 作ったものとか
</title>
<meta name=generator content="Hugo 0.89.0">
<meta name=copyright content="(C) 2017 Shuhei Kubota"><link rel=alternate type=application/atom+xml href=/index.xml>
<meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1">
<link href=/css/cheep.css rel=stylesheet>
<link href=/css/style.css rel=stylesheet>
</head>
<body>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-105605213-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<div class=header>
<a href=/>作ったものとか</a>&nbsp;&#187; <a href=/soft/>Softs</a>
</div>
<div class=main>
<div class=toc-area>
<nav id=TableOfContents>
<ul>
<li><a href=#ダウンロード>ダウンロード</a>
<ul>
<li><a href=#更新履歴>更新履歴</a></li>
</ul>
</li>
<li><a href=#使い方>使い方</a>
<ul>
<li><a href=#雛形の生成>雛形の生成</a></li>
<li><a href=#雛形の解説>雛形の解説</a></li>
<li><a href=#結果確認>結果確認</a></li>
<li><a href=#ルールのまとめ>ルールのまとめ</a></li>
<li><a href=#コマンドの生成>コマンドの生成</a></li>
</ul>
</li>
</ul>
</nav>
</div>
<div class=main-area>
<h1>wfw</h1>
<span class=tag><a href=/tags/system>system</a></span>
<p>Windows ファイアウォール向けのコマンドを生成するツール</p>
<p>受信ルール(リモートIPアドレスとローカルポート)の指定のみサポートしています。</p>
<p>広範囲のブロックを基本として、そこに許可するIPアドレスやポートを追加していくスタイルのルール記述(JSONフォーマット)から、Windows Firewall での設定を出力するためのツールです。</p>
<h1 id=ダウンロード>ダウンロード</h1>
<p><a href=https://github.com/shu-go/wfw/releases>ダウンロード</a></p>
<h2 id=更新履歴>更新履歴</h2>
<ul>
<li>0.3.1 (2021-10-30)
<ul>
<li>ルールが分割された場合に、分割後のルール名に分割の原因となったルール名を追記するようにする。</li>
<li>オプション &ndash;except でフォーマットを指定可能。(空白にすると追記なし)</li>
</ul>
</li>
<li>0.2.0 (2021-10-28)
<ul>
<li>オプション &ndash;format=json を追加。入力ファイルと同じフォーマットで出力できるようにする。</li>
</ul>
</li>
<li>0.1.1 (2021-10-20)
<ul>
<li>TCP もしくは UDP 以外のプロトコルの場合、localport を出力しないようにする</li>
</ul>
</li>
<li>0.1.0 (2021-10-19)
<ul>
<li>新規</li>
</ul>
</li>
</ul>
<h1 id=使い方>使い方</h1>
<p>ルールを JSON 形式で作成し、<code>wfw</code> に読み込ませて、コマンドを生成させます。</p>
<h2 id=雛形の生成>雛形の生成</h2>
<pre tabindex=0><code>wfw gen
</code></pre><p>ファイル <code>example.json</code> が作成されます。</p>
<p>この内容を参考にして、ルールを作ります。</p>
<h2 id=雛形の解説>雛形の解説</h2>
<pre tabindex=0><code>[
  {
    &quot;Name&quot;: &quot;allow HTTP&quot;,
    &quot;Desc&quot;: &quot;1st priority&quot;,
    &quot;Protocol&quot;: &quot;TCP&quot;,
    &quot;Allow&quot;: true,
    &quot;Port&quot;: &quot;80&quot;,
    &quot;IP&quot;: &quot;192.168.0.101&quot;
  },
  {
    &quot;Name&quot;: &quot;ban all 192.168&quot;,
    &quot;Desc&quot;: &quot;2nd priority&quot;,
    &quot;Protocol&quot;: &quot;TCP&quot;,
    &quot;Allow&quot;: false,
    &quot;Port&quot;: &quot;0-65535&quot;,
    &quot;IP&quot;: &quot;192.168.0.1-192.168.255.255&quot;
  },
  {
    &quot;Name&quot;: &quot;ban all 192.168&quot;,
    &quot;Desc&quot;: &quot;3rd priority, this rule will be disappeared&quot;,
    &quot;Protocol&quot;: &quot;TCP&quot;,
    &quot;Allow&quot;: true,
    &quot;Port&quot;: &quot;3389&quot;,
    &quot;IP&quot;: &quot;192.168.0.101&quot;
  }
]
</code></pre><p>最初のルール「allow HTTP」では、192.168.0.101 からの TCP 80 ポートアクセスを許可しています。</p>
<p>2番目のルール「ban all 192.168」では、192.168.0.1～255 からのすべての TCP アクセスをブロックしています。
ただし、最初のルールが優先されます。これは後ほどの<a href=#%E7%B5%90%E6%9E%9C%E7%A2%BA%E8%AA%8D>結果確認</a>で消えていることが確認できます。</p>
<p>最後のルールは、2番目のルールが優先されるため、結果的に消えてしまいます。</p>
<hr>
<p><code>Name</code> と <code>Desc</code> は、分かりやすいように記入します。
特に <code>Name</code> は Windows ファイアウォールの一覧に表示されます。</p>
<p><code>Protocol</code> は、Windows ファイアウォールの「プロトコルの種類」にあるものを記入してください。
<code>wfw</code> では特に内容のチェックまではしていません。</p>
<p><code>Allow</code> は、<code>true</code> で接続を許可することを、<code>false</code> で接続をブロックすることを意味します。</p>
<p><code>Port</code> で、許可・ブロックする(<code>Allow</code> の指定に依る)ポートを列挙します。
&ldquo;80, 443&rdquo; のように単独のポートを , で区切って指定することも、0-65535 のように範囲を指定することもできます。
(&ldquo;80, 443, 8080-8089&rdquo; のような指定も可能)</p>
<p><code>IP</code> には、このルールが適用されるスコープ(その中の「リモート IP アドレス」)を指定します。
<code>Port</code> 同様に、 , と - を使った複数指定ができます。</p>
<h2 id=結果確認>結果確認</h2>
<p>まずは、リスト表示で結果確認。</p>
<pre tabindex=0><code>wfw example.json
</code></pre><p>↓結果↓</p>
<pre tabindex=0><code>----------------------------------------
Name: allow HTTP
Desc: 1st priority
Action: allow
Protocol: TCP
Port: 80
IP: 192.168.0.101
----------------------------------------
Name: ban all 192.168
Desc: 2nd priority
Action: BLOCK
Protocol: TCP
Port: 0-65535
IP: 192.168.0.1-192.168.0.100,192.168.0.102-192.168.255.255
----------------------------------------
Name: ban all 192.168
Desc: 2nd priority
Action: BLOCK
Protocol: TCP
Port: 0-79,81-65535
IP: 192.168.0.101
</code></pre><p>結果として、3つのルールに分かれることがわかります。</p>
<p><code>example.json</code> の最初のルールが最初に、2番目のルールが2つに分かれています。</p>
<p>最初の結果は言わずもがな。</p>
<p>2番目は最初のルールにあった IP である 192.168.0.101 を避けてた IP になっていることがわかると思います。</p>
<p>最後は元々の2番目のルールが分かれたもので、192.168.0.101 からの TCP 80 ポート以外のアクセスをブロックしています。</p>
<h2 id=ルールのまとめ>ルールのまとめ</h2>
<ul>
<li>IP, Port は、, と - を使った複数指定が可能</li>
<li>上にあるルールが優先される</li>
<li>IP, Port は、優先されるルールの範囲を避けるように改変される
<ul>
<li>場合によっては、複数のルールに分割されることもある</li>
</ul>
</li>
</ul>
<h2 id=コマンドの生成>コマンドの生成</h2>
<p>先程までは結果の確認のためにリスト表示をしていました。</p>
<p>今度は netsh advfirewall 向けのコマンドを生成してみます。</p>
<p>※<code>wfw</code> では直接 Windows ファイアウォールのルールを書き換える機能はありません。</p>
<pre tabindex=0><code>wfw --format cmd example.json
</code></pre><p>↓結果↓</p>
<pre tabindex=0><code>netsh advfirewall firewall add rule  name=&quot;allow HTTP&quot;  enable=no
  description=&quot;1st priority&quot;
  dir=in  profile=any
  action=allow
  protocol=&quot;tcp&quot;  localport=&quot;80&quot;
  remoteip=&quot;192.168.0.101&quot;
netsh advfirewall firewall add rule  name=&quot;ban all 192.168&quot;  enable=no
  description=&quot;2nd priority&quot;
  dir=in  profile=any
  action=block
  protocol=&quot;tcp&quot;  localport=&quot;0-65535&quot;
  remoteip=&quot;192.168.0.1-192.168.0.100,192.168.0.102-192.168.255.255&quot;
netsh advfirewall firewall add rule  name=&quot;ban all 192.168&quot;  enable=no
  description=&quot;2nd priority&quot;
  dir=in  profile=any
  action=block
  protocol=&quot;tcp&quot;  localport=&quot;0-79,81-65535&quot;
  remoteip=&quot;192.168.0.101&quot;
</code></pre><p>※ページの見た目のため、本来は入っていない改行を入れています。</p>
<p>この結果を<strong>管理者権限で起動した</strong>コマンドプロンプトに貼り付ければ、Windows ファイアウォールのルールが追加されます。</p>
<hr>
<p>デフォルトでは無効化されたルールを作成するコマンドを生成します。
(上で生成されたコマンドでは <code>enable=no</code> となっていますね)</p>
<p>以下のようにすることで、最初から有効なルールを生成させることもできます。</p>
<pre tabindex=0><code>wfw -f cmd  --enabled  example.json
</code></pre><p>個人的にはこのオプションは使わず、無効化されたルールをよく確認した上で有効化することをおすすめします。</p>
<div class=single_pagenav>
<div class=single_pagenav_prev>
<a href=/soft/pomi/>&#171; pomi &#171;</a>
</div>
<div class=single_pagenav_next>
<a href=/soft/git-konfig/>&#187; git-konfig &#187;</a>
</div>
</div>
</div>
<div class=side-area>
<div class=profile><object type=image/svg+xml data="https://img.shields.io/badge/@chimatter-Follow-blue?style=for-the-badge&logo=twitter&logoColor=white&link=https://twitter.com/intent/user?screen_name=chimatter&link=https://twitter.com/intent/follow?screen_name=chimatter" style=margin-top:2em;margin-left:1em></object><p class=description>
</p>
</div>
<div class=latest_list_container>
<ul>
<li><a href=/hugo_theme/04/ title="現在作成途中のテーマ cheep をもとに、ダークモードへの取り組みを解説します。
今回は、比較的 Hugo 成分は少なめです。">
<span style=display:inline-block;text-decoration:none>📄 </span>Hugo テーマ 4. ダークモード<div class=latest_summary>現在作成途中のテーマ cheep をもとに、ダークモードへの取り組みを解説します。
今回は、比較的 </div></a></li>
<li><a href=/hugo_theme/03/ title="現在作成途中のテーマ cheep をもとに、最近の更新リストを実装する方法を解説します。">
<span style=display:inline-block;text-decoration:none>📄 </span>Hugo テーマ 3. 最近の更新リスト<div class=latest_summary>現在作成途中のテーマ cheep をもとに、最近の更新リストを実装する方法を解説します。</div></a></li>
<li><a href=/soft/wfw/ title="Windows ファイアウォール向けのコマンドを生成するツール">
<span style=display:inline-block;text-decoration:none>📄 </span>wfw<div class=latest_summary>Windows ファイアウォール向けのコマンドを生成するツール</div></a></li>
<li><a href=/soft/git-konfig/ title=gitconfigをエクスポート/インポートするツール>
<span style=display:inline-block;text-decoration:none>📄 </span>git-konfig<div class=latest_summary>gitconfigをエクスポート/インポートするツール</div></a></li>
<li><a href=/soft/vvin/ title="Windows のウィンドウサイズを操作する CLI アプリ">
<span style=display:inline-block;text-decoration:none>📄 </span>vvin<div class=latest_summary>Windows のウィンドウサイズを操作する CLI アプリ</div></a></li>
<li><a href=/soft/pmsync/ title="ポメラSyncされたメモを操作するツール 刷新版">
<span style=display:inline-block;text-decoration:none>📄 </span>pmsync<div class=latest_summary>ポメラSyncされたメモを操作するツール 刷新版</div></a></li>
<li><a href=/article/20210210-raspi_dlna_omv/ title="Raspberry Pi 4 のセットアップから OMV、その上に DLNA をセットアップするところまでを 粗く記録しておきます。
OpenMediaVault をインストールし、外付け SSD を共有フォルダーにしつつ、DLNA でデータ化した音楽・動画を視聴できるようにします。">
<span style=display:inline-block;text-decoration:none>📄 </span>Raspberry Pi 4 で DLNA/OMV セットアップ<div class=latest_summary>Raspberry Pi 4 のセットアップから OMV、その上に DLNA をセットアップするとこ</div></a></li>
<li><a href=/soft/slack-file/ title=Slackにアップされたファイルを操作するツール(主に削除)>
<span style=display:inline-block;text-decoration:none>📄 </span>slack-file<div class=latest_summary>Slackにアップされたファイルを操作するツール(主に削除)</div></a></li>
<li><a href=/article/20200603-sesame/ title="スマートロック SESAME で自動化">
<span style=display:inline-block;text-decoration:none>📄 </span>SESAME<div class=latest_summary>スマートロック SESAME で自動化</div></a></li>
<li><a href=/soft/ts/ title=標準入力にタイムスタンプを付加するコマンドラインツール>
<span style=display:inline-block;text-decoration:none>📄 </span>ts<div class=latest_summary>標準入力にタイムスタンプを付加するコマンドラインツール</div></a></li>
</ul>
</div>
<div class=tags_container>
<ul>
<li class=tag><a href=/tags/hugo>hugo<span class=tag_count>6</span></a></li>
<li class=tag><a href=/tags/pomera>pomera<span class=tag_count>2</span></a></li>
<li class=tag><a href=/tags/system>system<span class=tag_count>2</span></a></li>
<li class=tag><a href=/tags/git>git<span class=tag_count>1</span></a></li>
<li class=tag><a href=/tags/raspberrypi>raspberrypi<span class=tag_count>1</span></a></li>
<li class=tag><a href=/tags/sesame>sesame<span class=tag_count>1</span></a></li>
<li class=tag><a href=/tags/vim>vim<span class=tag_count>1</span></a></li>
</ul>
</div>
</div>
</div>
<div class=footer>
Top: <a href=/>作ったものとか</a> | <a rel=alternate type=application/atom+xml href=/index.xml>Feed</a><br>
(C) 2017 Shuhei Kubota<br>
Powered by <a href=https://gohugo.io/>Hugo</a><br>
</div>
<script src=/js/cheep.js></script>
<script>document.addEventListener("DOMContentLoaded",function(){for(var c=document.querySelectorAll(".lastmod"),b=0,d,a;b<c.length;b++)d=c[b],replaceSince(d);a=document.createElement("link"),a.setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),window.matchMedia('(prefers-color-scheme: dark)').matches?a.setAttribute("href","/css/syntax_dark.css"):a.setAttribute("href","/css/syntax.css"),document.getElementsByTagName("head")[0].appendChild(a)})</script>
</body>
</html>